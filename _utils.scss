// A collection of helper functions.

@use 'sass:math';
@use 'config';

// Given the base and ratio defined in config.font-size-scale(), scales the
// font-size exponentially: whitespace = base * (ratio ^ exponent). This can be
// used to create a proportionally increasing series of font-sizes.
@function scale-font-size($exponent) {
  $start: 1rem;
  $base: config.font-size-scale('base');
  $ratio: config.font-size-scale('ratio');
  @return _scale($start, $base, $ratio, $exponent);
}

// Given the base and ratio defined in config.whitespace-scale(), scales the
// whitespace exponentially: whitespace = base * (ratio ^ exponent). This can be
// used to create a proportionally increasing series of whitespaces.
@function scale-whitespace($exponent) {
  $start: config.whitespace();
  $base: config.whitespace-scale('base');
  $ratio: config.whitespace-scale('ratio');
  @return _scale($start, $base, $ratio, $exponent);
}

@function _scale($start, $base, $ratio, $exponent) {
  @if $exponent < 0 {
    @error 'Negative scaling is not supported.';
  }

  $growth: 1;
  @if $exponent > 0 {
    @for $i from 1 through $exponent {
      $growth: $growth * $ratio;
    }
  }

  @return $start * $base * $growth;
}

// `margin-bottom: 1rem` is smaller when it's assigned to a non-text item (img,
// hr, etc.) than when it's assigned to text. This is because text has a line-
// height that adds whitespace to margins. So, for non-text items, we need to
// pad their margins with an additional 0.5rem to simulate line-height. For
// example, the following two styles result in the same amount of whitespace
// underneath each item:
//
//   ```
//   p {
//     margin-bottom: config.whitespace();
//   }
//
//   img {
//     margin-bottom: non-text-whitespace();
//   }
//   ```
@function non-text-whitespace() {
  @return 0.5rem + config.whitespace();
}

// Proportionally scales font-size for a heading. Does not scale smaller than
// h4.
@function heading-font-size($heading-idx) {
  $scale-amount: math.max(4 - $heading-idx, 0);
  @return scale-font-size($scale-amount);
}

// Proportionally scales the whitespace above a heading. Does not scale smaller
// than h4.
@function heading-margin-top($heading-idx) {
  $scale-amount: math.max(4 - $heading-idx, 0);
  @return scale-whitespace($scale-amount);
}

// Proportionally scales the whitespace below a heading. Does not scale smaller
// than h4.
@function heading-margin-bottom($heading-idx) {
  $scale-amount: math.max(4 - $heading-idx, 0);
  $whitespace: scale-whitespace($scale-amount);
  $font-size: scale-font-size($scale-amount);
  @return $whitespace / ($font-size * config.line-height()) * 1rem;
}
